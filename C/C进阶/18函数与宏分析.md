<!--
 * @Author: your name
 * @Date: 2021-09-24 13:42:35
 * @LastEditTime: 2021-09-27 13:48:19
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /WorkSpace/C/C进阶/18函数与宏分析.md
-->

# 函数

## 函数与宏

- 宏是由预处理器直接替换展开的，编译器不知道宏的存在
- 函数是由编译器直接编译的实体，调用行为由编译器决定
- 多次使用宏会导致最终执行程序的体积增大
- 函数是跳转执行的，内存中只有一份函数体存在
- 宏的效率高于函数，因为是直接展开，无调用开销
- 函数调用时，会创建活动记录，效率不如宏

> - 宏的效率稍高，但是其副作用巨大
> - 宏是文本替换，参数无法进行类型检查
> - 可以使用函数完成的功能绝对不用宏
> - 宏的定义不能出现递归定义

### 宏的妙用

- 用于生成一些常规的代码
- 封装函数，加上类型信息

### 小结

- 宏和函数并不是竞争对手
- 宏能够接受任何类型的参数，效率高，易出错
- 函数的参数必须是固定类型，效率稍低，不易出错
- 宏可以实现函数不能实现的功能

## 递归函数

### 递归的数学思想

- 递归是一种数学上分而自治的思想
- 递归需要有边界条件
  - 当边界条件不满足时，递归继续进行
  - 当边界条件满足时，递归停止

### 递归函数

- 函数体内部可以调用自己
- 递归函数必须有递归出口
- 函数的无限递归将导致程序栈溢出而崩溃

### 小结

- 递归是一种将问题分而自治的思想
- 用递归解决问题首先要建立递归的模型
- 递归解法必须要有边界条件，否则无解

## 函数设计

### 函数设计原则

- 函数从意义上应该是一个独立的功能模块
- 函数名要在一定程度上反应函数的功能
- 函数参数名要能够体现参数意义
- 尽量避免在函数中使用全局变量
- 当函数参数不应该在函数内部被修改时，应加上const声明
- 如果参数是指针，且仅作输入参数，则应加上const声明
- 不能省略返回值的类型
  - 如果函数没有返回值，那么应该声明为void类型
- 对参数进行有效性检查
  - 对指针参数的检查尤为重要
- 不要返回指向“栈内存”的指针
  - 栈内存在函数结束时，被自动释放
- 函数体的规模要小，尽量控制在80行以内
- 相同输入对应相同输出，避免函数带“记忆”功能
- 避免函数有过多参数，参数个数尽可能控制在4个以内
- 有时候函数不需要返回值，但为了增加灵活性，可以附加返回值
- 函数名与返回值类型在语义上不可冲突
